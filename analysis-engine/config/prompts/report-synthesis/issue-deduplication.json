{
  "version": "1.0",
  "name": "issue-deduplication",
  "description": "Consolidates redundant findings from multiple analyzers into unique, non-repetitive insights",
  "model": "gpt-5-mini",
  "temperature": 0.3,
  "systemPrompt": "You are an expert at analyzing website audit findings and identifying redundant or overlapping issues. Your goal is to consolidate multiple analyzer outputs into unique, non-repetitive insights that maintain specificity while eliminating redundancy.\n\n**Core Principles:**\n\n1. **Merge Similar Issues**\n   - Identify issues describing the same underlying problem\n   - Preserve the most specific, actionable description\n   - Combine evidence from all sources\n   - Track original severity levels\n\n2. **Maintain Specificity**\n   - Don't over-generalize when merging\n   - Keep concrete examples and measurements\n   - Preserve viewport-specific details (desktop vs mobile)\n   - Maintain technical precision\n\n3. **Smart Categorization**\n   - Group by root cause, not symptoms\n   - Identify cascading issues (one root → multiple symptoms)\n   - Separate platform-specific from universal issues\n\n4. **Evidence Accumulation**\n   - Combine observations from multiple analyzers\n   - Create comprehensive evidence list\n   - Link to relevant screenshots\n   - Preserve source attribution\n\n**Merging Rules:**\n\n✅ **DO MERGE:**\n- Same issue observed on desktop AND mobile\n- SEO + Content both flagging missing meta descriptions\n- Multiple analyzers identifying same CTA problem\n- Visual + Accessibility both noting color contrast\n\n❌ **DON'T MERGE:**\n- Desktop layout issue vs Mobile touch target issue (different problems)\n- Missing alt text vs Missing meta description (different elements)\n- Hero section CTA vs Footer CTA (different locations)\n- High severity vs Low severity (preserve distinction)\n\n**Quality Checks:**\n- Each consolidated issue must be actionable\n- Business impact must be clear and specific\n- Technical details must be preserved\n- Effort estimation must consider full scope\n\n**Output Quality:**\nConsolidated issues should be MORE valuable than original issues:\n- Richer context from multiple perspectives\n- Clearer business impact\n- More comprehensive evidence\n- Better prioritization data",
  "userPromptTemplate": "Analyze these website audit findings for **{{company_name}}** ({{industry}}) and consolidate redundant issues.\n\n**Current Website Grade:** {{grade}} ({{overall_score}}/100)\n\n---\n\n**DESKTOP VISUAL ISSUES:**\n```json\n{{desktop_issues_json}}\n```\n\n**MOBILE VISUAL ISSUES:**\n```json\n{{mobile_issues_json}}\n```\n\n**SEO ISSUES:**\n```json\n{{seo_issues_json}}\n```\n\n**CONTENT ISSUES:**\n```json\n{{content_issues_json}}\n```\n\n**SOCIAL MEDIA ISSUES:**\n```json\n{{social_issues_json}}\n```\n\n**ACCESSIBILITY ISSUES:**\n```json\n{{accessibility_issues_json}}\n```\n\n---\n\n**Your Task:**\n\n1. Identify all redundant or overlapping issues\n2. Merge related issues into consolidated findings\n3. Preserve viewport-specific details (desktop vs mobile)\n4. Combine evidence from multiple sources\n5. Maintain highest severity level when merging\n6. Track which analyzers contributed to each finding\n\n**Return consolidated issues in this EXACT JSON format:**\n\n```json\n{\n  \"consolidatedIssues\": [\n    {\n      \"id\": \"ISSUE-001\",\n      \"title\": \"Consolidated issue title (specific and actionable)\",\n      \"description\": \"Combined description with all relevant context and measurements\",\n      \"sources\": [\"desktop\", \"mobile\", \"seo\"],\n      \"severity\": \"critical|high|medium|low\",\n      \"category\": \"layout|cta|navigation|content|seo|accessibility|performance|mobile\",\n      \"impact\": \"Specific business impact with quantification where possible\",\n      \"effort\": \"quick-win|medium|major\",\n      \"priority\": \"high|medium|low\",\n      \"evidence\": [\n        \"Specific observation from desktop analyzer\",\n        \"Specific observation from mobile analyzer\",\n        \"Specific observation from SEO analyzer\"\n      ],\n      \"affectedPages\": [\"homepage\", \"about\", \"services\"],\n      \"screenshotRefs\": [\"SS-1\", \"SS-3\"],\n      \"originalIssueIds\": [\"desktop-issue-2\", \"mobile-issue-5\", \"seo-issue-3\"]\n    }\n  ],\n  \"mergeLog\": [\n    {\n      \"consolidatedIssueId\": \"ISSUE-001\",\n      \"consolidatedTitle\": \"Title of consolidated issue\",\n      \"mergedFrom\": [\n        {\n          \"source\": \"desktop\",\n          \"originalTitle\": \"Original desktop issue title\",\n          \"originalSeverity\": \"high\"\n        },\n        {\n          \"source\": \"mobile\",\n          \"originalTitle\": \"Original mobile issue title\",\n          \"originalSeverity\": \"critical\"\n        }\n      ],\n      \"mergeReason\": \"Both issues identify the same CTA visibility problem across different viewports\",\n      \"finalSeverity\": \"critical\",\n      \"severityReason\": \"Elevated to critical due to mobile severity\"\n    }\n  ],\n  \"statistics\": {\n    \"originalIssueCount\": 42,\n    \"consolidatedIssueCount\": 18,\n    \"reductionPercentage\": 57,\n    \"mergeCount\": 24,\n    \"uniqueIssueCount\": 18\n  }\n}\n```\n\n**Important:**\n- Preserve ALL unique issues (don't merge unrelated issues)\n- For merged issues, use the MOST SPECIFIC description\n- Combine evidence lists from all sources\n- Use HIGHEST severity level when merging\n- Track original issue IDs for auditability\n- Ensure each consolidated issue is actionable and non-redundant",
  "variables": [
    "company_name",
    "industry",
    "grade",
    "overall_score",
    "desktop_issues_json",
    "mobile_issues_json",
    "seo_issues_json",
    "content_issues_json",
    "social_issues_json",
    "accessibility_issues_json"
  ],
  "outputFormat": {
    "type": "json",
    "schema": {
      "consolidatedIssues": [
        {
          "id": "string (ISSUE-001 format)",
          "title": "string (specific, actionable)",
          "description": "string (comprehensive, with measurements)",
          "sources": [
            "array of strings (desktop|mobile|seo|content|social|accessibility)"
          ],
          "severity": "critical|high|medium|low",
          "category": "layout|cta|navigation|content|seo|accessibility|performance|mobile",
          "impact": "string (quantified business impact)",
          "effort": "quick-win|medium|major",
          "priority": "high|medium|low",
          "evidence": [
            "array of specific observations"
          ],
          "affectedPages": [
            "array of page URLs"
          ],
          "screenshotRefs": [
            "array of screenshot IDs"
          ],
          "originalIssueIds": [
            "array of original issue identifiers"
          ]
        }
      ],
      "mergeLog": [
        {
          "consolidatedIssueId": "string",
          "consolidatedTitle": "string",
          "mergedFrom": [
            {
              "source": "string",
              "originalTitle": "string",
              "originalSeverity": "string"
            }
          ],
          "mergeReason": "string",
          "finalSeverity": "string",
          "severityReason": "string"
        }
      ],
      "statistics": {
        "originalIssueCount": "number",
        "consolidatedIssueCount": "number",
        "reductionPercentage": "number",
        "mergeCount": "number",
        "uniqueIssueCount": "number"
      }
    }
  },
  "examples": [
    {
      "input": {
        "desktop_issues": [
          {
            "title": "Hero section CTA button too small",
            "description": "Primary CTA 'Get Started' is 14px font, same size as body text",
            "severity": "high",
            "category": "cta"
          }
        ],
        "mobile_issues": [
          {
            "title": "Call-to-action buttons lack visual prominence",
            "description": "Primary action buttons blend with secondary links, no color differentiation",
            "severity": "critical",
            "category": "cta"
          }
        ],
        "seo_issues": [
          {
            "title": "Primary conversion path unclear",
            "description": "No clear CTA in above-the-fold HTML structure",
            "severity": "medium",
            "category": "conversion"
          }
        ]
      },
      "output": {
        "consolidatedIssues": [
          {
            "id": "ISSUE-001",
            "title": "Primary CTA lacks prominence across all devices",
            "description": "The main 'Get Started' call-to-action button fails to stand out on both desktop and mobile. Desktop: button uses 14px font (same as body text) with no size differentiation. Mobile: button blends with secondary links due to lack of color contrast and visual hierarchy. HTML structure shows no semantic emphasis for primary conversion path.",
            "sources": [
              "desktop",
              "mobile",
              "seo"
            ],
            "severity": "critical",
            "category": "cta",
            "impact": "Primary conversion action is not immediately visible to visitors, resulting in lost leads. Industry benchmarks show prominent CTAs can increase conversions by 30-50%. Critical on mobile where 60% of traffic originates.",
            "effort": "quick-win",
            "priority": "high",
            "evidence": [
              "Desktop: 'Get Started' button is 14px font, identical to body text size",
              "Mobile: Primary CTA buttons have no color differentiation from secondary links",
              "SEO: No semantic HTML emphasis on primary conversion path in above-fold structure"
            ],
            "affectedPages": [
              "homepage",
              "services"
            ],
            "screenshotRefs": [
              "SS-1",
              "SS-2"
            ],
            "originalIssueIds": [
              "desktop-cta-1",
              "mobile-cta-3",
              "seo-conversion-2"
            ]
          }
        ],
        "mergeLog": [
          {
            "consolidatedIssueId": "ISSUE-001",
            "consolidatedTitle": "Primary CTA lacks prominence across all devices",
            "mergedFrom": [
              {
                "source": "desktop",
                "originalTitle": "Hero section CTA button too small",
                "originalSeverity": "high"
              },
              {
                "source": "mobile",
                "originalTitle": "Call-to-action buttons lack visual prominence",
                "originalSeverity": "critical"
              },
              {
                "source": "seo",
                "originalTitle": "Primary conversion path unclear",
                "originalSeverity": "medium"
              }
            ],
            "mergeReason": "All three issues identify the same underlying problem: primary CTA is not visually prominent. Desktop noted size issue, mobile noted contrast issue, SEO noted structural issue - all symptoms of one root problem.",
            "finalSeverity": "critical",
            "severityReason": "Elevated to critical due to mobile severity and multi-platform impact affecting majority of traffic"
          }
        ],
        "statistics": {
          "originalIssueCount": 3,
          "consolidatedIssueCount": 1,
          "reductionPercentage": 67,
          "mergeCount": 3,
          "uniqueIssueCount": 1
        }
      }
    }
  ],
  "costEstimate": {
    "model": "gpt-5-mini-mini",
    "inputTokens": "~4000 (all analyzer outputs)",
    "outputTokens": "~2000 (consolidated issues + merge log)",
    "estimatedCost": "$0.036 per synthesis"
  },
  "notes": [
    "This is the first step in the synthesis pipeline",
    "Reduces report redundancy by 50-70%",
    "Maintains all unique findings while merging overlaps",
    "Provides merge audit trail for transparency",
    "Critical for professional, non-repetitive reports"
  ]
}