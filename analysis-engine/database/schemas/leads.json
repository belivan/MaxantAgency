{
  "table": "leads",
  "description": "Analyzed leads ready for outreach - output from analysis engine",

  "columns": [
    {
      "name": "id",
      "type": "uuid",
      "primaryKey": true,
      "default": "gen_random_uuid()",
      "description": "Unique lead ID"
    },
    {
      "name": "prospect_id",
      "type": "uuid",
      "index": true,
      "description": "Foreign key to prospects table"
    },

    {
      "name": "company_name",
      "type": "text",
      "required": true,
      "description": "Company/business name"
    },
    {
      "name": "industry",
      "type": "text",
      "description": "Industry type (restaurant, dentist, law-firm, etc.)"
    },
    {
      "name": "url",
      "type": "text",
      "required": true,
      "unique": true,
      "description": "Website URL"
    },
    {
      "name": "city",
      "type": "text",
      "description": "Business city/location"
    },
    {
      "name": "state",
      "type": "text",
      "description": "Business state (NY, CA, etc.)"
    },

    {
      "name": "contact_email",
      "type": "text",
      "description": "Contact email (extracted from website or enriched)"
    },
    {
      "name": "contact_phone",
      "type": "text",
      "description": "Contact phone (extracted from website)"
    },
    {
      "name": "contact_name",
      "type": "text",
      "description": "Contact person name (if available)"
    },

    {
      "name": "website_grade",
      "type": "text",
      "required": true,
      "index": true,
      "description": "Letter grade A-F"
    },
    {
      "name": "overall_score",
      "type": "decimal",
      "required": true,
      "index": true,
      "description": "Overall score 0-100"
    },

    {
      "name": "design_score",
      "type": "decimal",
      "required": true,
      "description": "Design analysis score 0-100 (legacy - use design_score_desktop/mobile for new records)"
    },
    {
      "name": "design_score_desktop",
      "type": "integer",
      "description": "Desktop design analysis score 0-100"
    },
    {
      "name": "design_score_mobile",
      "type": "integer",
      "description": "Mobile design analysis score 0-100"
    },
    {
      "name": "seo_score",
      "type": "decimal",
      "required": true,
      "description": "SEO analysis score 0-100"
    },
    {
      "name": "content_score",
      "type": "decimal",
      "required": true,
      "description": "Content analysis score 0-100"
    },
    {
      "name": "social_score",
      "type": "decimal",
      "required": true,
      "description": "Social media analysis score 0-100"
    },

    {
      "name": "design_issues",
      "type": "jsonb",
      "default": "[]",
      "description": "Array of design issues found (legacy - use design_issues_desktop/mobile for new records)"
    },
    {
      "name": "design_issues_desktop",
      "type": "jsonb",
      "default": "[]",
      "description": "Array of desktop-specific design issues"
    },
    {
      "name": "design_issues_mobile",
      "type": "jsonb",
      "default": "[]",
      "description": "Array of mobile-specific design issues"
    },
    {
      "name": "mobile_critical_issues",
      "type": "integer",
      "default": 0,
      "description": "Count of high-priority mobile design issues"
    },
    {
      "name": "desktop_critical_issues",
      "type": "integer",
      "default": 0,
      "description": "Count of high-priority desktop design issues"
    },
    {
      "name": "visual_analysis_model",
      "type": "text",
      "description": "AI model used for visual analysis (gpt-5, grok-4, etc.)"
    },
    {
      "name": "seo_issues",
      "type": "jsonb",
      "default": "[]",
      "description": "Array of SEO issues found"
    },
    {
      "name": "content_issues",
      "type": "jsonb",
      "default": "[]",
      "description": "Array of content issues found"
    },
    {
      "name": "social_issues",
      "type": "jsonb",
      "default": "[]",
      "description": "Array of social media issues found"
    },

    {
      "name": "quick_wins",
      "type": "jsonb",
      "default": "[]",
      "description": "Array of quick-win opportunities"
    },

    {
      "name": "analysis_summary",
      "type": "text",
      "description": "Human-readable analysis summary (for email)"
    },
    {
      "name": "top_issue",
      "type": "jsonb",
      "description": "Most critical issue (for outreach hook)"
    },
    {
      "name": "one_liner",
      "type": "text",
      "description": "One-line critique for email subject/preview"
    },
    {
      "name": "call_to_action",
      "type": "text",
      "description": "Suggested CTA for outreach email"
    },

    {
      "name": "tech_stack",
      "type": "text",
      "description": "Detected technology stack (WordPress, Shopify, etc.)"
    },
    {
      "name": "page_load_time",
      "type": "integer",
      "description": "Page load time in milliseconds"
    },
    {
      "name": "is_mobile_friendly",
      "type": "boolean",
      "default": false,
      "description": "Is the site mobile-friendly?"
    },
    {
      "name": "has_https",
      "type": "boolean",
      "default": false,
      "description": "Does the site use HTTPS?"
    },

    {
      "name": "screenshot_url",
      "type": "text",
      "description": "URL to stored screenshot (S3 or similar)"
    },

    {
      "name": "social_profiles",
      "type": "jsonb",
      "description": "Social media profile URLs"
    },
    {
      "name": "social_platforms_present",
      "type": "jsonb",
      "description": "Array of social platforms found"
    },
    {
      "name": "social_metadata",
      "type": "jsonb",
      "description": "Social media metadata and engagement data"
    },

    {
      "name": "has_blog",
      "type": "boolean",
      "default": false,
      "description": "Does the site have a blog?"
    },
    {
      "name": "content_insights",
      "type": "jsonb",
      "description": "Content analysis insights and recommendations"
    },

    {
      "name": "page_title",
      "type": "text",
      "description": "Page title tag"
    },
    {
      "name": "meta_description",
      "type": "text",
      "description": "Meta description tag"
    },

    {
      "name": "status",
      "type": "text",
      "enum": ["ready_for_outreach", "email_composed", "contacted", "replied", "not_interested"],
      "default": "ready_for_outreach",
      "index": true,
      "description": "Lead status in outreach pipeline"
    },

    {
      "name": "lead_priority",
      "type": "integer",
      "index": true,
      "description": "AI-scored lead quality/priority (0-100, higher = better)"
    },
    {
      "name": "lead_priority_reasoning",
      "type": "text",
      "description": "AI-generated explanation for the priority score"
    },
    {
      "name": "priority_tier",
      "type": "text",
      "enum": ["hot", "warm", "cold"],
      "index": true,
      "description": "Categorical priority tier - hot: 75-100, warm: 50-74, cold: 0-49"
    },
    {
      "name": "budget_likelihood",
      "type": "text",
      "enum": ["high", "medium", "low"],
      "description": "Estimated budget capacity based on business signals"
    },
    {
      "name": "fit_score",
      "type": "integer",
      "description": "How well the prospect fits the Ideal Customer Profile (0-100)"
    },

    {
      "name": "quality_gap_score",
      "type": "integer",
      "description": "Quality gap dimension score (0-25) - how much improvement potential exists"
    },
    {
      "name": "budget_score",
      "type": "integer",
      "description": "Budget dimension score (0-25) - estimated budget capacity"
    },
    {
      "name": "urgency_score",
      "type": "integer",
      "description": "Urgency dimension score (0-20) - how urgently they need help"
    },
    {
      "name": "industry_fit_score",
      "type": "integer",
      "description": "Industry fit dimension score (0-15) - how well they match target industry"
    },
    {
      "name": "company_size_score",
      "type": "integer",
      "description": "Company size dimension score (0-10) - company size assessment"
    },
    {
      "name": "engagement_score",
      "type": "integer",
      "description": "Engagement dimension score (0-5) - social media engagement level"
    },

    {
      "name": "business_intelligence",
      "type": "jsonb",
      "description": "Extracted business intelligence data (years in business, employee count, pricing, decision makers, etc.)"
    },

    {
      "name": "crawl_metadata",
      "type": "jsonb",
      "description": "Multi-page crawl metadata (pages crawled, links found, crawl time, failed pages)"
    },

    {
      "name": "project_id",
      "type": "uuid",
      "description": "Associated project ID (if lead converts)"
    },

    {
      "name": "analyzed_at",
      "type": "timestamptz",
      "default": "now()",
      "description": "When the analysis was performed"
    },
    {
      "name": "analysis_cost",
      "type": "decimal",
      "description": "Cost of analysis in USD"
    },
    {
      "name": "analysis_time",
      "type": "integer",
      "description": "Analysis time in milliseconds"
    },

    {
      "name": "created_at",
      "type": "timestamptz",
      "default": "now()",
      "description": "Record creation timestamp"
    },
    {
      "name": "updated_at",
      "type": "timestamptz",
      "default": "now()",
      "description": "Record last update timestamp"
    }
  ],

  "indexes": [
    {
      "name": "idx_leads_status_grade",
      "columns": ["status", "website_grade"]
    },
    {
      "name": "idx_leads_industry_score",
      "columns": ["industry", "overall_score"]
    },
    {
      "name": "idx_leads_analyzed_at",
      "columns": ["analyzed_at"]
    },
    {
      "name": "idx_leads_priority_tier_score",
      "columns": ["priority_tier", "lead_priority"]
    },
    {
      "name": "idx_leads_priority_budget_status",
      "columns": ["priority_tier", "budget_likelihood", "status"]
    }
  ],

  "foreignKeys": [
    {
      "column": "prospect_id",
      "references": "prospects.id",
      "onDelete": "SET NULL"
    },
    {
      "column": "project_id",
      "references": "projects.id",
      "onDelete": "SET NULL"
    }
  ],

  "constraints": [
    {
      "type": "check",
      "name": "chk_overall_score_range",
      "expression": "overall_score >= 0 AND overall_score <= 100"
    },
    {
      "type": "check",
      "name": "chk_design_score_range",
      "expression": "design_score >= 0 AND design_score <= 100"
    },
    {
      "type": "check",
      "name": "chk_design_score_desktop_range",
      "expression": "design_score_desktop IS NULL OR (design_score_desktop >= 0 AND design_score_desktop <= 100)"
    },
    {
      "type": "check",
      "name": "chk_design_score_mobile_range",
      "expression": "design_score_mobile IS NULL OR (design_score_mobile >= 0 AND design_score_mobile <= 100)"
    },
    {
      "type": "check",
      "name": "chk_mobile_critical_issues_positive",
      "expression": "mobile_critical_issues >= 0"
    },
    {
      "type": "check",
      "name": "chk_desktop_critical_issues_positive",
      "expression": "desktop_critical_issues >= 0"
    },
    {
      "type": "check",
      "name": "chk_seo_score_range",
      "expression": "seo_score >= 0 AND seo_score <= 100"
    },
    {
      "type": "check",
      "name": "chk_content_score_range",
      "expression": "content_score >= 0 AND content_score <= 100"
    },
    {
      "type": "check",
      "name": "chk_social_score_range",
      "expression": "social_score >= 0 AND social_score <= 100"
    },
    {
      "type": "check",
      "name": "chk_analysis_cost_positive",
      "expression": "analysis_cost IS NULL OR analysis_cost >= 0"
    },
    {
      "type": "check",
      "name": "chk_page_load_time_positive",
      "expression": "page_load_time IS NULL OR page_load_time >= 0"
    },
    {
      "type": "check",
      "name": "chk_analysis_time_positive",
      "expression": "analysis_time IS NULL OR analysis_time >= 0"
    },
    {
      "type": "check",
      "name": "chk_lead_priority_range",
      "expression": "lead_priority IS NULL OR (lead_priority >= 0 AND lead_priority <= 100)"
    },
    {
      "type": "check",
      "name": "chk_fit_score_range",
      "expression": "fit_score IS NULL OR (fit_score >= 0 AND fit_score <= 100)"
    }
  ]
}
