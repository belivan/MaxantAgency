{
  "table": "project_prospects",
  "description": "Junction table linking prospects to projects (many-to-many relationship)",

  "columns": [
    {
      "name": "id",
      "type": "uuid",
      "primaryKey": true,
      "default": "gen_random_uuid()",
      "description": "Unique identifier for the link"
    },
    {
      "name": "project_id",
      "type": "uuid",
      "required": true,
      "index": true,
      "description": "Reference to the project"
    },
    {
      "name": "prospect_id",
      "type": "uuid",
      "required": true,
      "index": true,
      "description": "Reference to the prospect"
    },
    {
      "name": "run_id",
      "type": "text",
      "index": true,
      "description": "Prospecting run that added this prospect to this project"
    },
    {
      "name": "added_at",
      "type": "timestamptz",
      "default": "now()",
      "description": "When this prospect was added to this project"
    },
    {
      "name": "notes",
      "type": "text",
      "description": "Project-specific notes about this prospect"
    },
    {
      "name": "custom_score",
      "type": "integer",
      "description": "Project-specific custom score (0-100)"
    },
    {
      "name": "status",
      "type": "text",
      "enum": ["active", "contacted", "qualified", "disqualified", "archived"],
      "default": "active",
      "index": true,
      "description": "Project-specific status for this prospect"
    },
    {
      "name": "discovery_query",
      "type": "text",
      "description": "AI-generated search query that discovered this prospect for this project"
    },
    {
      "name": "query_generation_model",
      "type": "text",
      "description": "AI model used for query understanding (e.g., 'grok-4-fast', 'gpt-4o')"
    },
    {
      "name": "icp_brief_snapshot",
      "type": "jsonb",
      "description": "Snapshot of the project's ICP brief when this prospect was discovered"
    },
    {
      "name": "prompts_snapshot",
      "type": "jsonb",
      "description": "Snapshot of all prompts used during discovery (queryUnderstanding, websiteExtraction, relevanceCheck)"
    },
    {
      "name": "model_selections_snapshot",
      "type": "jsonb",
      "description": "Snapshot of model selections for each AI step during discovery"
    },
    {
      "name": "relevance_reasoning",
      "type": "text",
      "description": "AI's explanation for why this prospect matches the project's ICP"
    },
    {
      "name": "discovery_cost_usd",
      "type": "decimal",
      "description": "Total API cost to discover and enrich this prospect for this project (USD)"
    },
    {
      "name": "discovery_time_ms",
      "type": "integer",
      "description": "Time taken to discover and enrich this prospect for this project (milliseconds)"
    }
  ],

  "foreignKeys": [
    {
      "column": "project_id",
      "references": "projects.id",
      "onDelete": "CASCADE"
    },
    {
      "column": "prospect_id",
      "references": "prospects.id",
      "onDelete": "CASCADE"
    }
  ],

  "indexes": [
    {
      "name": "idx_project_prospects_project",
      "columns": ["project_id", "status"]
    },
    {
      "name": "idx_project_prospects_prospect",
      "columns": ["prospect_id"]
    }
  ],

  "constraints": [
    {
      "type": "unique",
      "name": "uq_project_prospect",
      "columns": ["project_id", "prospect_id"],
      "description": "Prevent same prospect being added twice to same project"
    },
    {
      "type": "check",
      "name": "chk_custom_score_range",
      "expression": "custom_score IS NULL OR (custom_score >= 0 AND custom_score <= 100)"
    },
    {
      "type": "check",
      "name": "chk_discovery_cost_positive",
      "expression": "discovery_cost_usd IS NULL OR discovery_cost_usd >= 0"
    },
    {
      "type": "check",
      "name": "chk_discovery_time_positive",
      "expression": "discovery_time_ms IS NULL OR discovery_time_ms >= 0"
    }
  ]
}
