# Caddy configuration for MaxantAgency Backend
# Auto-HTTPS enabled by default
# Note: CORS is handled by backend Express servers, not Caddy

api.mintydesign.xyz {

    # Prospecting Engine
    handle /prospecting/* {
        uri strip_prefix /prospecting
        reverse_proxy prospecting-engine:3010
    }

    # Analysis Engine
    handle /analysis/* {
        uri strip_prefix /analysis
        reverse_proxy analysis-engine:3001
    }

    # Report Engine
    handle /reports/* {
        uri strip_prefix /reports
        reverse_proxy report-engine:3003
    }

    # Outreach Engine
    handle /outreach/* {
        uri strip_prefix /outreach
        reverse_proxy outreach-engine:3002
    }

    # Pipeline Orchestrator
    handle /pipeline/* {
        uri strip_prefix /pipeline
        reverse_proxy pipeline-orchestrator:3020
    }

    # Static file storage (PDFs, screenshots)
    # Served from /opt/MaxantAgency/storage/
    handle /storage/* {
        uri strip_prefix /storage
        root * /opt/MaxantAgency/storage
        file_server
    }

    # Health check endpoint
    handle /health {
        respond "OK" 200
    }

    # Default - return 404 for unmatched routes
    handle {
        respond "Not Found" 404
    }
}
