{
  "table": "campaign_runs",
  "description": "Execution history and audit log for campaign runs",

  "columns": [
    {
      "name": "id",
      "type": "uuid",
      "primaryKey": true,
      "default": "gen_random_uuid()"
    },
    {
      "name": "campaign_id",
      "type": "uuid",
      "required": true,
      "description": "Reference to parent campaign"
    },
    {
      "name": "started_at",
      "type": "timestamptz",
      "default": "now()",
      "description": "When the run started"
    },
    {
      "name": "completed_at",
      "type": "timestamptz",
      "description": "When the run finished (success or failure)"
    },
    {
      "name": "status",
      "type": "text",
      "enum": ["running", "completed", "failed", "aborted"],
      "default": "running",
      "description": "Current run status"
    },
    {
      "name": "steps_completed",
      "type": "integer",
      "default": 0,
      "description": "Number of steps successfully completed"
    },
    {
      "name": "steps_failed",
      "type": "integer",
      "default": 0,
      "description": "Number of steps that failed"
    },
    {
      "name": "results",
      "type": "jsonb",
      "description": "Detailed results from each step execution"
    },
    {
      "name": "total_cost",
      "type": "decimal(10,2)",
      "default": 0,
      "description": "Total cost for this run"
    },
    {
      "name": "errors",
      "type": "jsonb",
      "description": "Array of error objects from failed steps"
    },
    {
      "name": "trigger_type",
      "type": "text",
      "enum": ["scheduled", "manual"],
      "default": "scheduled",
      "description": "How the run was triggered"
    }
  ],

  "indexes": [
    {
      "name": "idx_campaign_runs_campaign_id",
      "columns": ["campaign_id"]
    },
    {
      "name": "idx_campaign_runs_status",
      "columns": ["status"]
    },
    {
      "name": "idx_campaign_runs_started_at",
      "columns": ["started_at"]
    }
  ],

  "foreignKeys": [
    {
      "column": "campaign_id",
      "references": "campaigns.id",
      "onDelete": "CASCADE"
    }
  ],

  "constraints": [
    {
      "type": "check",
      "name": "chk_steps_completed_positive",
      "expression": "steps_completed >= 0"
    },
    {
      "type": "check",
      "name": "chk_steps_failed_positive",
      "expression": "steps_failed >= 0"
    },
    {
      "type": "check",
      "name": "chk_total_cost_positive",
      "expression": "total_cost >= 0"
    },
    {
      "type": "check",
      "name": "chk_run_times_order",
      "expression": "completed_at IS NULL OR completed_at >= started_at"
    }
  ]
}
